<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="https://unpkg.com/jspsych@7.3.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
        <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
        <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
        <script src="jsPsych/modified-image-plugin.js"></script> 
        <script src="https://unpkg.com/@jspsych/plugin-canvas-slider-response@1.1.2"></script>
        <script src="sentences.js"></script>
        <script src="associations.js"></script>
        <script src="priming.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
        <script src="use.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.2"></script>
        <script src="valence_training.js"></script>
        <script src="novel.js"></script>
        <script src="congruent.js"></script>
        <script src="incongruent.js"></script>
    
    </head>
    <body></body>
    <script>
        const jsPsych = initJsPsych () ;
         var initial_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Hello, welcome to the experiment.',
                'Today you will be completing a series of exercises related to cognition.',
                'In the first task, you will read sentences with novel words. You will be occasionally presented attention checks. Once you read each sentence, press spacebar to continue.'
            ],
            show_clickable_nav: true
         }
         var association_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'The sentence reading activity is complete. Now is time for our next task. Write the first word that comes to mind when presented with the stimuli.'
            ],
            show_clickable_nav: true
         }

         var priming_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'You will be presented with two words. Match the second word to match to the visual stimuli of either a horse or apple, using the keys A and L. (A = left and L = right).'
            ],
            show_clickable_nav: true
         }

         var sentence_number= 0

         var sentence = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable('sentence'),
            choices: [' '],
            //trial_duration: 500,
            on_finish: function(data) {
                sentence_number = (sentence_number +1) % 40
                console.log("sentence_number= " + sentence_number)
            }
    }

    var random_attention_trials = jsPsych.randomization.sampleWithoutReplacement([...Array(35).keys()].map(x=> x+5), 3)

    console.log("random_attention_trials= " + random_attention_trials);

    var attention = {
        type:jsPsychSurveyText,
        questions: [{prompt: "Type any ONE novel word from the previous sentence:"} ]
    }

    var attention_conditional = {
        timeline: [attention],
        conditional_function: function() {
            if(random_attention_trials.includes(sentence_number)) {return true;}
            else {return false;}
        }
 }     
    var training_procedure = {
        timeline: [sentence, attention_conditional],
        timeline_variables: sentences, 
        randomize_order: true 
    }

    var association = {
        type:jsPsychSurveyText,
        questions: [{prompt: jsPsych.timelineVariable('cue')}],
    }

    var association_procedure = {
        timeline: [association],
        timeline_variables: association_cues, 
        randomize_order: true,
        repetitions: 3
    }
    

    var training_plus_association = {
        timeline: [training_procedure, association_instructions, association_procedure],
        repetitions: 3
    }

    var slow_experiment_trial = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "<b> Too slow</b>! <br><br> Please try to respond faster.",
        choices: "NO_KEYS",
        trial_duration: 1000
    }

    var fixation = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "+",
        choices: "NO_KEYS",
        trial_duration: 500,

    }

    var image = {
        type:jsPsychImageKeyboardResponse,
        stimulus: jsPsych.timelineVariable('image_path'),
        choices: "NO_KEYS",
        trial_duration: 500,
        stimulus_width: 500,
        maintain_aspect_rato: true,
        prompt: "<span style = 'font-size:20%'><br><br></span>"
    }

    var prime = {
        type:jsPsychImageKeyboardResponse,
        stimulus: jsPsych.timelineVariable('image_path'),
        choices: "NO_KEYS",
        trial_duration: 300,
        stimulus_width: 500,
        maintain_aspect_rato: true,
        prompt: function() {
            return "<span style= 'font-size:200%'><br>" + String(jsPsych.timelineVariable('prime_word')) + "<br></span>";
    }}
    

    var target = {
        type:jsPsychImageKeyboardResponse,
        stimulus: jsPsych.timelineVariable('image_path'),
        choices: ['A', 'L'],
        stimulus_width: 500,
        maintain_aspect_rato: true,
        prompt: function() {
            return "<span style= 'font-size:200%'><br>" + String(jsPsych.timelineVariable('target_word')) + "<br></span>";
    }}

    var priming_feedback = {
        timeline: [slow_experiment_trial],
        conditional_function: function () {
            var rt = jsPsych.data.get().last(1).values() [0]. rt;
            if (rt > 800) {
                return true;
        }   else{
                return false;
        }
        }
    }

    var priming_proc = {
        timeline: [fixation, image, prime, target, priming_feedback],
        timeline_variables: practice_stimuli,
        randomize_order: true
        }
    
        var iat_valence_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Next, you will complete an association task.',
                'When a word appears in the center of your screen, click the key “A” if it is a good word and “L” if it is a bad word.'
            ],
            show_clickable_nav: true }

       var iat_valence_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left',
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
           // force_correct_key_press: true,
           // display_feedback: true,
            //trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['GOOD'],
            right_category_label: ['BAD'],
            response_ends_trial: true
            
        
    
      }

       var iat_valence_procedure = { 
            timeline:[iat_valence_training],
            timeline_variables: valence_cues, 
            randomize_order: true, 
            repetitions: 10, }

         var iat_novel_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'In the next section, you will differentiate between the made-up words you saw earlier in the experiment, and random words.',
                ' If the word in the center of the screen is one of the familiar made-up words from earlier, press “A”. If it is a random word you have not seen before, press “L"'
            ],
            show_clickable_nav: true }

        var iat_novel_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left',
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS'],
            right_category_label: ['RANDOM WORDS'],
            response_ends_trial: true
            
    
      }

       var iat_novel_procedure = { 
            timeline:[iat_novel_training],
            timeline_variables: novel_cues, 
            randomize_order: true, 
            repetitions: 10, }

        var iat_congruent_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Now, you will differentiate between both good and bad words, and familiar made-up words and random words.',
                'If the word is either good OR familiar made-up, press “A”. If it is either bad OR random, press “L”.' ],
            show_clickable_nav: true }

        var iat_congruent_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left',
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS', 'GOOD'],
            right_category_label: ['RANDOM WORDS', 'BAD'],
            response_ends_trial: true
            
    
      }

       var iat_congruent_procedure = { 
            timeline:[iat_congruent_training],
            timeline_variables: congruent_cues, 
            randomize_order: true, 
            repetitions: 10, }

        var iat_incongruent_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'If the word is either good OR random, press “A”. If it is either bad OR familiar made-up, press “L”.'
            ],
            show_clickable_nav: true }

        var iat_incongruent_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left' ,
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS', 'BAD'],
            right_category_label: ['RANDOM WORDS', 'GOOD'],
            response_ends_trial: true
            
    
      }

       var iat_incongruent_procedure = { 
            timeline:[iat_incongruent_training],
            timeline_variables: incongruent_cues, 
            randomize_order: true, 
            repetitions: 10, }
    
        var use_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Next you will write a few sentences using the novel words.'
            ],
            show_clickable_nav: true }
   

       var use = {
        type:jsPsychSurveyText,
        questions:[{prompt: jsPsych.timelineVariable('cue')}],
       }
       var use_procedure= {
        timeline: [use],
        timeline_variables: use_cues,
        randomize_order: true,
        repetitions: 3
       }

       var age_gender_demo = {
        type:jsPsychSurveyText,
        questions:[{prompt: "What is your age?"},
        {prompt: 'What is your gender?'}, 
        {prompt:'How many years of formal education have you had? (consider graduating high school to be 12 years)'}],
       } 

       var demo_survey = {
            type: jsPsychSurveyMultiSelect,
            questions: [
            {
            prompt: "Please select all the racial categories that apply to you:", 
            options: ["American Indian/Alaskan Native", "Asian", "Black/African American", "Native Hawaiian or Other Pacific Islander", "White/Caucasian", "More than once race", "Other"], 
            horizontal: true,
            required: true,
            name: 'Race'
            }, 
            {
            prompt: "What is your dominant hand?", 
            options: ["Right", "Left", "Ambidextrous"], 
            horizontal: true,
            required: true,
            name: 'Hand'
            },
            {
            prompt: "Please indicate what time of the day you feel most alert:", 
            options: ["Morning", "Afternoon", "Evening", "No differences"], 
            horizontal: true,
            required: true,
            name: 'Time_of_day'
            }]
       }

        var demo_lang=  {
            type: jsPsychSurveyMultiSelect
            prompt: "Is English your first language?", 
            options: ["Yes", "No"], 
            horizontal: true,
            required: true,
            name: 'First_language'
            }

       var other_info_demo = {
        type:jsPsychSurveyText,
        questions:[{prompt: 'Is there anything else we should know about, which might have affected your performance during the experiment? (e.g., lack of sleep, feeling ill etc.)'}]
       }

       var thank_you = {
        type: jsPsychHtmlKeyboardResponse,
            stimulus: 'Thank you, you can press any key to end the experiment',
            data: {
                typeoftrial: 'thank_you'
            },
       }





       jsPsych.run([initial_instructions, training_plus_association, priming_instructions, priming_proc, iat_valence_instructions, iat_valence_procedure, iat_novel_instructions, iat_novel_procedure, iat_congruent_instructions, iat_congruent_procedure, iat_incongruent_instructions, iat_incongruent_procedure, use_instructions, use_procedure
]);
    </script>
</html>