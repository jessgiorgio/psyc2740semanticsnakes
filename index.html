<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="https://unpkg.com/jspsych@7.3.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
        <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
        <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
        <script src="jsPsych/modified-image-plugin.js"></script> 
        <script src="https://unpkg.com/@jspsych/plugin-canvas-slider-response@1.1.2"></script>
        <script src="sentences.js"></script>
        <script src="associations.js"></script>
        <script src="priming.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
        <script src="use.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.2"></script>
        <script src="valence_training.js"></script>
        <script src="novel.js"></script>
        <script src="congruent.js"></script>
        <script src="incongruent.js"></script>
    
    </head>
    <body></body>
    <script>
        const jsPsych = initJsPsych () ;
         var initial_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Hello, welcome to the experiment.',
                'Today you will be completing a series of exercises related to cognition.',
                'In the first task, you will read sentences with novel words. You will be occasionally presented attention checks. Once you read each sentence, press spacebar to continue.'
            ],
            show_clickable_nav: true
         }
         var association_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'The sentence reading activity is complete. Now is time for our next task. Write the first word that comes to mind when presented with the stimuli.'
            ],
            show_clickable_nav: true
         }


         var sentence_number= 0

         var sentence = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable('sentence'),
            choices: [' '],
            //trial_duration: 500,
            on_finish: function(data) {
                sentence_number = (sentence_number +1) % 40
                console.log("sentence_number= " + sentence_number)
            }
    }

    var random_attention_trials = jsPsych.randomization.sampleWithoutReplacement([...Array(35).keys()].map(x=> x+5), 3)

    console.log("random_attention_trials= " + random_attention_trials);

    var attention = {
        type:jsPsychSurveyText,
        questions: [{prompt: "Type any ONE novel word from the previous sentence:"} ]
    }

    var attention_conditional = {
        timeline: [attention],
        conditional_function: function() {
            if(random_attention_trials.includes(sentence_number)) {return true;}
            else {return false;}
        }
 }     
    var training_procedure = {
        timeline: [sentence, attention_conditional],
        timeline_variables: sentences, 
        randomize_order: true 
    }

    var association = {
        type:jsPsychSurveyText,
        questions: [{prompt: jsPsych.timelineVariable('cue')}],
    }

    var association_procedure = {
        timeline: [association],
        timeline_variables: association_cues, 
        randomize_order: true,
        repetitions: 3
    }
    

    var training_plus_association = {
        timeline: [training_procedure, association_instructions, association_procedure],
        repetitions: 3
    }


    


    
        var iat_valence_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Next, you will complete an association task.',
                'When a word appears in the center of your screen, click the key “A” if it is a good word and “L” if it is a bad word.'
            ],
            show_clickable_nav: true }

       var iat_valence_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left',
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
           // force_correct_key_press: true,
           // display_feedback: true,
            //trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['GOOD'],
            right_category_label: ['BAD'],
            response_ends_trial: true,
            data: {
                correct_key: jsPsych.timelineVariable('correct_key'),
            }
            
        
    
      }

       var iat_valence_procedure = { 
            timeline:[iat_valence_training],
            timeline_variables: valence_cues, 
            randomize_order: true, 
            repetitions: 10, }

         var iat_novel_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'In the next section, you will differentiate between the made-up words you saw earlier in the experiment, and random words.',
                ' If the word in the center of the screen is one of the familiar made-up words from earlier, press “A”. If it is a random word you have not seen before, press “L"'
            ],
            show_clickable_nav: true }

        var iat_novel_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: jsPsych.timelineVarible ("correct_key"),
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            force_correct_key_press: true,
            display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS'],
            right_category_label: ['RANDOM WORDS'],
            response_ends_trial: true,
           
            
    
      }

       var iat_novel_procedure = { 
            timeline:[iat_novel_training],
            timeline_variables: novel_cues, 
            randomize_order: true, 
            repetitions: 10, }

        var iat_congruent_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Now, you will differentiate between both good and bad words, and familiar made-up words and random words.',
                'If the word is either good OR familiar made-up, press “A”. If it is either bad OR random, press “L”.' ],
            show_clickable_nav: true }

        var iat_congruent_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left',
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS', 'GOOD'],
            right_category_label: ['RANDOM WORDS', 'BAD'],
            response_ends_trial: true
            
    
      }

       var iat_congruent_procedure = { 
            timeline:[iat_congruent_training],
            timeline_variables: congruent_cues, 
            randomize_order: true, 
            repetitions: 10, }

        var iat_incongruent_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'If the word is either good OR random, press “A”. If it is either bad OR familiar made-up, press “L”.'
            ],
            show_clickable_nav: true }

        var iat_incongruent_training  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: 'left' ,
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['NOVEL WORDS', 'BAD'],
            right_category_label: ['RANDOM WORDS', 'GOOD'],
            response_ends_trial: true
            
    
      }

       var iat_incongruent_procedure = { 
            timeline:[iat_incongruent_training],
            timeline_variables: incongruent_cues, 
            randomize_order: true, 
            repetitions: 10, }
    
        var use_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Next you will write a few sentences using the novel words.'
            ],
            show_clickable_nav: true }
   

       var use = {
        type:jsPsychSurveyText,
        questions:[{prompt: jsPsych.timelineVariable('cue')}],
       }
       var use_procedure= {
        timeline: [use],
        timeline_variables: use_cues,
        randomize_order: true,
        repetitions: 3

        
       }


       jsPsych.run([iat_novel_procedure
]);
    </script>
</html>