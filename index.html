<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <script src="https://unpkg.com/jspsych@7.3.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
        <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
        <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
        <script src="jsPsych/modified-image-plugin.js"></script> 
        <script src="https://unpkg.com/@jspsych/plugin-canvas-slider-response@1.1.2"></script>
        <script src="sentences.js"></script>
        <script src="associations.js"></script>
        <script src="priming.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
        <script src="use.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-iat-html@1.1.2"></script>
        <script src="valence_training.js"></script>
        <script src="novel.js"></script>
        <script src="congruent.js"></script>
        <script src="incongruent.js"></script>
        <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
        <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.2"></script>
        <script src="table.md"></script>
    
    </head>
    <body></body>
    <script>
        const jsPsych = initJsPsych ({on_finish: function(data){

       // jsPsych.data.displayData();
}}) ;
       
         var id = Math.floor(Math.random () * 10000000000);
         console.log("id =", id)

         jsPsych.data.addProperties({
            ID: id
         })

         var initial_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Hello, welcome to the experiment.',
                'Today you will be completing a series of exercises related to cognition.',
                'In the first task, you will read sentences with madeup words (pseudowords). Please read carefully. You will be occasionally presented with attention checks. Press the spacebar after you have read each sentnece.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'
         } }

         var association_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Now you will write the first word that comes to mind when presented with the stimuli.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'
         } }


         var sentence_number= 0

         var sentence = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable('sentence'),
            choices: [' '],
            //trial_duration: 500,
            on_finish: function(data) {
                sentence_number = (sentence_number +1) % 40
                console.log("sentence_number= " + sentence_number)
            }, 
            data: {
                typeoftrial: 'sentence',
                sentence:jsPsych.timelineVariable('sentence'),
                novel1:jsPsych.timelineVariable('novel1'),
                novel2:jsPsych.timelineVariable('novel2'),
                novel3:jsPsych.timelineVariable('novel3')
    } }

    var random_attention_trials = jsPsych.randomization.sampleWithoutReplacement([...Array(35).keys()].map(x=> x+5), 3)

    console.log("random_attention_trials= " + random_attention_trials);

    var attention = {
        type:jsPsychSurveyText,
        questions: [{prompt: "Type any ONE pseudoword from the previous sentence:"} ],
        data: {
                typeoftrial: 'attention',
    },
    on_finish: function(data) {
        var last_trial_data = jsPsych.data.get().filter({typeoftrial:'sentence'}).last(1).values() [0];
        console.log("last_trial_data = ", last_trial_data);

        data.novel1 = last_trial_data.novel1;
        data.novel2 = last_trial_data.novel2;
        data.novel3 = last_trial_data.novel3;
        data.response = data.response.Q0;

        if (
            jsPsych.pluginAPI.compareKeys(data.response, data.novel1) ||
            jsPsych.pluginAPI.compareKeys(data.response, data.novel2) ||
            jsPsych.pluginAPI.compareKeys(data.response, data.novel3)  ) 
             {
            data.correct = 1;
            console.log("correct = " + data.correct);
        } else {
            data.correct = 0;
            console.log("correct = " + data.correct)
        }
        }
    } 
    

    var attention_conditional = {
        timeline: [attention],
        conditional_function: function() {
            if(random_attention_trials.includes(sentence_number)) {return true;}
            else {return false;}
        }
 }     
    var training_procedure = {
        timeline: [sentence, attention_conditional],
        timeline_variables: sentences, 
        randomize_order: true 
    }

    var association = {
        type:jsPsychSurveyText,
        preamble: 'Type in the first word that comes to mind when you see the word below:',
        questions: [{prompt: jsPsych.timelineVariable('cue')}],
        trial_duration: 10, 
        data: {
                typeoftrial: 'association',
                cue: jsPsych.timelineVariable('cue') },
                on_finish: function(data){
                    data.response = data.response.Q0          
                }

    } 

    var association_procedure = {
        timeline: [association],
        timeline_variables: association_cues, 
        randomize_order: true,
        repetitions: 3
    }
    

    var training_plus_association = {
        timeline: [training_procedure, association_instructions, association_procedure],
        repetitions: 3
    }
    var iat_general_instructions = { 
            type: jsPsychInstructions,
            pages: [
                "Next, you will use the 'A' and 'L' computer keys to categorize items into groups as fast as you can. These are the four groups and the items that belong to each.",
                "table.md"
                
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

        var iat_valence_instructions1 = { 
            type: jsPsychInstructions,
            pages: [
                'Next, you will complete an Implicit Asociation Test (IAT). You will be asked to sort words into groups based on the indicated categories on the left and right side of the screen. Please complete this sorting as fast as you can.',
                'You will have two practice trials that give you feedback on incorrect attempts to help familiarize yourself with the procedure. ',
                'Here is the first practice session: When a word appears in the center of your screen, click the key “A” if it is a <b>good</b> word and “L” if it is a <b>bad</b> word.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

       var iat_valence_training1  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: ['A', 'L'],
            stim_key_association: jsPsych.timelineVariable ("correct_key1"),
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            force_correct_key_press: true,
            display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['GOOD'],
            right_category_label: ['BAD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'valence_iat'
            }}

            var iat_valence_instructions2 = { 
            type: jsPsychInstructions,
            pages: [
                'Next, you will complete an Implicit Asociation Test (IAT). You will be asked to sort words into groups based on the indicated categories on the left and right side of the screen. Please complete this sorting as fast as you can.',
                'You will have two practice trials that give you feedback on incorrect attempts to help familiarize yourself with the procedure. ',
                'Here is the first practice session: When a word appears in the center of your screen, click the key “A” if it is a <b>good</b> word and “L” if it is a <b>bad</b> word.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

            
            var iat_valence_training2  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: ['A', 'L'],
            stim_key_association: jsPsych.timelineVariable ("correct_key2"),
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            force_correct_key_press: true,
            display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['BAD'],
            right_category_label: ['GOOD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'valence_iat'
            }
            
    }

            var iat_valence_procedure1 = { 
            timeline:[iat_valence_training1],
            timeline_variables: valence_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var valence_timeline1 = {
                timeline: [iat_valence_instructions1, iat_valence_procedure1]
            }

            var iat_valence_procedure2 = { 
            timeline:[iat_valence_training2],
            timeline_variables: valence_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var valence_timeline2 = {
                timeline: [iat_valence_instructions2, iat_valence_procedure2]
            }


            var valence = {
                timeline: [valence_timeline1, valence_timeline2]
            }

            function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
shuffleArray(valence.timeline);


         var iat_novel_instructions1 = { 
            type: jsPsychInstructions,
            pages: [
                'In the next practice section, you will differentiate between the <b>familiar pseudowords</b> (made-up words included in the experiment), and <b>random pseudowords</b> (unfamiliar made-up words).',
                ' If the word in the center of the screen is one of the <b>familiar psuedowords</b>, press “A”. If it is a <b>random pseudoword</b> you have not seen before, press “L".'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

        var iat_novel_training1  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: ['A', 'L'],
            stim_key_association: jsPsych.timelineVariable ("correct_key1"),
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            force_correct_key_press: true,
            display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['FAMILIAR PSEUDOWORDS'],
            right_category_label: ['RANDOM PSEUDOWORDS'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'novel_iat'
            } 
        }

        var iat_novel_instructions2 = { 
            type: jsPsychInstructions,
            pages: [
                'In the next practice section, you will differentiate between the <b>familiar pseudowords</b> (made-up words included in the experiment), and <b>random pseudowords</b> (unfamiliar made-up words).',
                ' If the word in the center of the screen is one of the <b>familiar psuedowords</b>, press “A”. If it is a <b>random pseudoword</b> you have not seen before, press “L".'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }
           
            var iat_novel_training2  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: ['A', 'L'],
            stim_key_association: jsPsych.timelineVariable ("correct_key2"),
            html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
            force_correct_key_press: true,
            display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['RANDOM PSEUDOWORDS'],
            right_category_label: ['FAMILIAR PSEUDOWORDS'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'novel_iat'
            }
           
    
      }

            var iat_novel_procedure1 = { 
            timeline:[iat_novel_training1],
            timeline_variables: novel_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var novel_timeline1 = {
                timeline: [iat_novel_instructions1, iat_novel_procedure1]
            }

            var iat_novel_procedure2 = { 
            timeline:[iat_novel_training2],
            timeline_variables: novel_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var novel_timeline2 = {
                timeline: [iat_novel_instructions2, iat_novel_procedure2]
            }

            var novel = {
                timeline: [novel_timeline1, novel_timeline2]
            }

            function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
shuffleArray(novel.timeline);


        var iat_congruent_instructions1 = { 
            type: jsPsychInstructions,
            pages: [
                'Now, you will differentiate between both <b>good and bad words</b>, and <b>familiar pseudowords</b> (made-up words included in the experiment) and <b>random pseudowords</b> (unfamiliar made-up words).',
                'If the word is either a <b>good or familiar pseudoword</b>, press “A”. If it is either a <b>bad or random pseudoword</b>, press “L”.' ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

        var iat_congruent_training1  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: jsPsych.timelineVariable ("correct_key1"),
            //html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: 'Please answer as quickly as possible.',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['FAMILIAR PSEUDOWORDS', 'GOOD'],
            right_category_label: ['RANDOM PSEUDOWORDS', 'BAD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'congruent_iat'
            }
            
    
      }
      var iat_congruent_instructions2 = { 
            type: jsPsychInstructions,
            pages: [
                'Now, you will differentiate between both <b>good and bad words</b>, and <b>familiar pseudowords</b> (made-up words included in the experiment) and <b>random pseudowords</b> (unfamiliar made-up words).',
                'If the word is either a <b>good or familiar pseudoword</b>, press “A”. If it is either a <b>bad or random pseudoword</b>, press “L”.' ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'} }

      var iat_congruent_training2  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: jsPsych.timelineVariable ("correct_key2"),
            //html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: 'Please answer as quickly as possible.',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 3000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['RANDOM PSEUDOWORDS', 'BAD'],
            right_category_label: ['FAMILIAR PSEUDOWORDS', 'GOOD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'congruent_iat'
            }
            
      }

            var iat_congruent_procedure1 = { 
            timeline:[iat_congruent_training1],
            timeline_variables: congruent_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var congruent_timeline1 = {
                timeline: [iat_congruent_instructions1, iat_congruent_procedure1]
            }

            var iat_congruent_procedure2 = { 
            timeline:[iat_congruent_training2],
            timeline_variables: congruent_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var congruent_timeline2 = {
                timeline: [iat_congruent_instructions2, iat_congruent_procedure2]
            }

            var congruent = {
                timeline: [congruent_timeline1, congruent_timeline2]
            }

            function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
shuffleArray(congruent.timeline);

        var iat_incongruent_instructions1 = { 
            type: jsPsychInstructions,
            pages: [
                'If the word is either <b>good or random pseudoword</b> (an unfamiliar made-up word), press “A”. If it is either a <b>bad or familiar psuedoword</b> (a made-up word included in the experiment), press “L”.'
            ],
            show_clickable_nav: true, 
            data: {
                typeoftrial: 'instructions'}}

        var iat_incongruent_training1  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: jsPsych.timelineVariable ("correct_key1"),
            //html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: 'Please answer as quickly as possible.',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 2000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['FAMILIAR PSEUDOWORDS', 'BAD'],
            right_category_label: ['RANDOM PSEUDOWORDS', 'GOOD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'incongruent_iat'
            }
            
    
      }
      var iat_incongruent_instructions2 = { 
            type: jsPsychInstructions,
            pages: [
                'If the word is either <b>good or random pseudoword</b> (an unfamiliar made-up word), press “A”. If it is either a <b>bad or familiar psuedoword</b> (a made-up word included in the experiment), press “L”.'
            ],
            show_clickable_nav: true, 
            data: {
                typeoftrial: 'instructions'}}

      var iat_incongruent_training2  = {
            type: jsPsychIatHtml,
            stimulus:jsPsych.timelineVariable("cue"),
            key_to_move_forward: "ALL_KEYS",
            stim_key_association: jsPsych.timelineVariable ("correct_key2"),
            //html_when_wrong:'<span style="color: red; font-size: 80px">X</span>',
            bottom_instructions: 'Please answer as quickly as possible.',
            //force_correct_key_press: true,
            //display_feedback: true,
            trial_duration: 2000, //Only if display_feedback is false,
            left_category_key: 'A',
            right_category_key: 'L',
            left_category_label: ['RANDOM PSEUDOWORDS', 'GOOD'],
            right_category_label: ['FAMILIAR PSEUDOWORDS', 'BAD'],
            response_ends_trial: true,
            data: {
                typeoftrial: 'incongruent_iat'
            }
            
    
      }


       var iat_incongruent_procedure1 = { 
            timeline:[iat_incongruent_training1],
            timeline_variables: incongruent_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var incongruent_timeline1 = {
                timeline: [iat_incongruent_instructions1, iat_incongruent_procedure1]
            }

            var iat_incongruent_procedure2 = { 
            timeline:[iat_incongruent_training2],
            timeline_variables: incongruent_cues, 
            randomize_order: true, 
            repetitions: 1, }

            var incongruent_timeline2 = {
                timeline: [iat_incongruent_instructions2, iat_incongruent_procedure2]
            }

            var incongruent = {
                timeline: [incongruent_timeline1, incongruent_timeline2]
            }

            function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
shuffleArray(incongruent.timeline);
    
        var use_instructions = { 
            type: jsPsychInstructions,
            pages: [
                'Next you will write a few sentences using specifc words.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'}
        }
        
       var iat_timeline = {
        timeline: [valence, novel, congruent, incongruent] }

       var use = {
        type:jsPsychSurveyText,
        questions:[{prompt: jsPsych.timelineVariable('cue')}],
        data: {
            typeoftrial: 'use_in_sentence'
        },
        on_finish: function(data) {
            data.response = data.response.Q0
                    }
       }

       var use_procedure= {
        timeline: [use],
        timeline_variables: use_cues,
        randomize_order: true,
        repetitions: 3

        
       }
       var use_timeline = {
        timeline: [use_instructions, use_procedure]
        }

var extensions = {
    timeline: [iat_timeline, use_timeline],
};

function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
shuffleArray(extensions.timeline);


var demo_instructions = {
    type:jsPsychInstructions,
            pages: [
                'Thank you for your effort so far in this experiment. Finally, you will fill out a short demographics survey.'
            ],
            show_clickable_nav: true,
            data: {
                typeoftrial: 'instructions'}
        }

       
	    var age_gender_educ_demo = {
        type: jsPsychSurveyText,
        questions:[{prompt: "What is your age?", required: true},
        {prompt: 'What is your gender?', required: true}, 
        {prompt:'How many years of formal education have you had? (consider graduating high school to be 12 years)', required: true}],
        required_error: 'Please answer all questions on this page',

        data: {
            typeoftrial: 'demopt1'
        }, 

        on_finish: function(data) {  
                data.age = data.response.Q0;
                data.gender = data.response.Q1;
                data.educ = data.response.Q2;
        }
        }

       var demo_survey = {
            type: jsPsychSurveyMultiSelect,
            questions: [
            {
            prompt: "Please select all the racial categories that apply to you:", 
            options: ["American Indian/Alaskan Native", "Asian", "Black/African American", "Native Hawaiian or Other Pacific Islander", "White/Caucasian", "More than once race", "Other"], 
            horizontal: true,
            required: true,
            name: 'race'
            }, 
            {
            prompt: "What is your dominant hand?", 
            options: ["Right", "Left", "Ambidextrous"], 
            horizontal: true,
            required: true,
            name: 'hand'
            },
            {
            prompt: "Please indicate what time of the day you feel most alert:", 
            options: ["Morning", "Afternoon", "Evening", "No differences"], 
            horizontal: true,
            required: true,
            name: 'alert'
            }],
            data:{
                typeoftrial: 'demopt2'
            },

            on_finish: function(data) {  
                data.race = data.response.Q0;
                data.hand = data.response.Q1;
                data.alert = data.response.Q2;
            }
        }

      
        var additionalQuestions = {
        timeline: [
            {
            type: jsPsychSurveyText,
            questions: [
                { prompt: 'What is your first language?', required: true },
                { prompt: 'At what age did you learn English?', required: true },
            ],
            },
        ],
        };

        var demo_lang = {
        type: jsPsychHtmlButtonResponse,
        stimulus: 'Is English your first language?',
        choices: ['No', 'Yes'],
        data: {
            typeoftrial: 'language',
        },
       
        }

        var not_english = {
            timeline: [additionalQuestions],
            conditinal_function: function () {
                var last_trial_data = jsPsych.data.get().last(1).values()[0];
                console.log("last_trial_data =", last_trial_data);

                if (last_trial_data.response == 0) {
                    return true
                } 
                else {
                    return false
                }
                }
            }

        var language = {
            timeline: [demo_lang, not_english]
        }



       var other_info_demo = {
        type:jsPsychSurveyText,
        questions:[{prompt: 'Is there anything else we should know about, which might have affected your performance during the experiment? (e.g., lack of sleep, feeling ill etc.)'}],
            data: {
                typeoftrial: 'other_info'
            },
            on_finish: function(data) {
                data.other_info = data.response.Q0;
                }
    }

        var demographics= {
                    timeline: [age_gender_educ_demo, demo_survey, language, other_info_demo]
                }

       var thank_you = {
        type: jsPsychHtmlKeyboardResponse,
            stimulus: 'Thank you! You can press any key to end the experiment.',
            data: {
                typeoftrial: 'thank_you'
            },
       }


       jsPsych.run([iat_general_instructions])
    </script>
</html>